sap.ui.define([                                                                                                                                                                                                                                                
	"sap/ui/base/Object",                                                                                                                                                                                                                                         
], function (Object) {                                                                                                                                                                                                                                         
	"use strict";                                                                                                                                                                                                                                                 
	/**                                                                                                                                                                                                                                                           
	 * Common Data Service :                                                                                                                                                                                                                                      
	 * */                                                                                                                                                                                                                                                         
	return Object.extend("com.toray.massreceipt.libs.DataServices", {                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
		/********************************************************************                                                                                                                                                                                        
		 *  Read a single object from oData Model and return it as a promise                                                                                                                                                                                         
		 ********************************************************************/                                                                                                                                                                                       
		readObjectPromise: function ({ model, path, entityName, key, forceReload, urlParameters, busyControl }) {                                                                                                                                                    
			let oObjectData = {};                                                                                                                                                                                                                                       
			return new Promise((resolve, reject) => {                                                                                                                                                                                                                   
				if (typeof model !== "object") {                                                                                                                                                                                                                           
					reject();                                                                                                                                                                                                                                                 
				}                                                                                                                                                                                                                                                          
				let sEntityPath = path; //If path provided take it&nbsp;                                                                                                                                                                                                   
				if (typeof sEntityPath === "undefined" || sEntityPath === "") { //else build the path using the entity name and key                                                                                                                                        
					sEntityPath = model.createKey(entityName, key);                                                                                                                                                                                                           
				}                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
				if (forceReload === false) { //try to find the object in the already loaded data of the oData Model and return it                                                                                                                                          
					oObjectData = model.getObject(sEntityPath);                                                                                                                                                                                                               
					if (typeof oObjectData === 'object') {                                                                                                                                                                                                                    
						resolve(oObjectData);                                                                                                                                                                                                                                    
					}                                                                                                                                                                                                                                                         
				}                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
				if (busyControl != null && busyControl instanceof Object) {                                                                                                                                                                                                
					busyControl.setBusy(true);                                                                                                                                                                                                                                
				}                                                                                                                                                                                                                                                          
				model.read(sEntityPath, {                                                                                                                                                                                                                                  
					urlParameters: urlParameters,                                                                                                                                                                                                                             
					success: function (oData) {                                                                                                                                                                                                                               
						if (busyControl != null && busyControl instanceof Object) {                                                                                                                                                                                              
							busyControl.setBusy(false);                                                                                                                                                                                                                             
						}                                                                                                                                                                                                                                                        
						resolve(oData);                                                                                                                                                                                                                                          
					},                                                                                                                                                                                                                                                        
					error: function (oError) {                                                                                                                                                                                                                                
						if (busyControl != null && busyControl instanceof Object) {                                                                                                                                                                                              
							busyControl.setBusy(false);                                                                                                                                                                                                                             
						}                                                                                                                                                                                                                                                        
						reject(oError);                                                                                                                                                                                                                                          
					}                                                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/*******************************************************************                                                                                                                                                                                         
		 *  Read a objects set from oData Model and return it as a promise                                                                                                                                                                                           
		 *******************************************************************/                                                                                                                                                                                        
		readObjectsSetPromise: function ({ model, path, entityName, urlParameters, filters, sorters, busyControl }) {                                                                                                                                                
			return new Promise((resolve, reject) => {                                                                                                                                                                                                                   
				if (typeof model !== "object") {                                                                                                                                                                                                                           
					reject();                                                                                                                                                                                                                                                 
				}                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
				let sEntitySetPath = path; //If path provided take it&nbsp;                                                                                                                                                                                                
				if (typeof sEntitySetPath === "undefined" || sEntitySetPath === "") { //else build the path using the entity name and key                                                                                                                                  
					sEntitySetPath = entityName;                                                                                                                                                                                                                              
				}                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
				if (busyControl != null && busyControl instanceof Object) {                                                                                                                                                                                                
					busyControl.setBusy(true);                                                                                                                                                                                                                                
				}                                                                                                                                                                                                                                                          
				model.read(sEntitySetPath, {                                                                                                                                                                                                                               
					filters: filters,                                                                                                                                                                                                                                         
					sorters: sorters,                                                                                                                                                                                                                                         
					urlParameters: urlParameters,                                                                                                                                                                                                                             
					success: function (oData) {                                                                                                                                                                                                                               
						if (busyControl != null && busyControl instanceof Object) {                                                                                                                                                                                              
							busyControl.setBusy(false);                                                                                                                                                                                                                             
						}                                                                                                                                                                                                                                                        
						resolve(oData);                                                                                                                                                                                                                                          
					},                                                                                                                                                                                                                                                        
					error: function (oError) {                                                                                                                                                                                                                                
						if (busyControl != null && busyControl instanceof Object) {                                                                                                                                                                                              
							busyControl.setBusy(false);                                                                                                                                                                                                                             
						}                                                                                                                                                                                                                                                        
						reject(oError);                                                                                                                                                                                                                                          
					}                                                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
		/*************************************************************************                                                                                                                                                                                   
		 *  Submit Changes on OData Model for a given group and return a promise                                                                                                                                                                                     
		 *************************************************************************/                                                                                                                                                                                  
		submitChanges: function ({ model, idGroup, busyControl }) {                                                                                                                                                                                                  
			return new Promise((resolve, reject) => {                                                                                                                                                                                                                   
				if (typeof model !== "object") {                                                                                                                                                                                                                           
					reject();                                                                                                                                                                                                                                                 
				}                                                                                                                                                                                                                                                          
				if (model.hasPendingChanges() === false) { //No pending modification -> do nothing                                                                                                                                                                         
					resolve({});                                                                                                                                                                                                                                              
				}                                                                                                                                                                                                                                                          
				if (busyControl != null && busyControl instanceof Object) {                                                                                                                                                                                                
					busyControl.setBusy(true);                                                                                                                                                                                                                                
				}                                                                                                                                                                                                                                                          
				model.submitChanges({                                                                                                                                                                                                                                      
					groupId: idGroup,                                                                                                                                                                                                                                         
					success: (oData) => {                                                                                                                                                                                                                                     
						if (busyControl != null && busyControl instanceof Object) {                                                                                                                                                                                              
							busyControl.setBusy(false);                                                                                                                                                                                                                             
						}                                                                                                                                                                                                                                                        
						//Check the response&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                             
						if (typeof oData.__batchResponses !== "undefined") {                                                                                                                                                                                                     
							for (let index = 0; index < oData.__batchResponses.length; index++) {                                                                                                                                                                                   
								const batchResponse = oData.__batchResponses[index];                                                                                                                                                                                                   
								let oResponse = batchResponse.response;                                                                                                                                                                                                                
								if (typeof oResponse !== "undefined" && oResponse.statusCode !== "200") { //An error has occured during submit                                                                                                                                         
									reject(oResponse);                                                                                                                                                                                                                                    
									return;                                                                                                                                                                                                                                               
								}                                                                                                                                                                                                                                                      
							}                                                                                                                                                                                                                                                       
						}                                                                                                                                                                                                                                                        
						resolve(oData);                                                                                                                                                                                                                                          
					},                                                                                                                                                                                                                                                        
					error: (oError) => { //Error during submit                                                                                                                                                                                                                
						if (busyControl != null && busyControl instanceof Object) {                                                                                                                                                                                              
							busyControl.setBusy(false);                                                                                                                                                                                                                             
						}                                                                                                                                                                                                                                                        
						reject(oError);                                                                                                                                                                                                                                          
					}                                                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		/***************************************************************                                                                                                                                                                                             
		 *  Trigger a DELETE request and and return a promise                                                                                                                                                                                                        
		 ***************************************************************/                                                                                                                                                                                            
		removeObject({ model, path, idGroup, busyControl }) {                                                                                                                                                                                                        
			return new Promise((resolve, reject) => {                                                                                                                                                                                                                   
				if (typeof model !== "object") {                                                                                                                                                                                                                           
					reject();                                                                                                                                                                                                                                                 
				}                                                                                                                                                                                                                                                          
				if (busyControl != null && busyControl instanceof Object) {                                                                                                                                                                                                
					busyControl.setBusy(true);                                                                                                                                                                                                                                
				}                                                                                                                                                                                                                                                          
				model.remove(path, {                                                                                                                                                                                                                                       
					groupId: idGroup,                                                                                                                                                                                                                                         
					success: function (oData) {                                                                                                                                                                                                                               
						if (busyControl != null && busyControl instanceof Object) {                                                                                                                                                                                              
							busyControl.setBusy(false);                                                                                                                                                                                                                             
						}                                                                                                                                                                                                                                                        
						resolve(oData);                                                                                                                                                                                                                                          
					},                                                                                                                                                                                                                                                        
					error: function (oError) {                                                                                                                                                                                                                                
						if (busyControl != null && busyControl instanceof Object) {                                                                                                                                                                                              
							busyControl.setBusy(false);                                                                                                                                                                                                                             
						}                                                                                                                                                                                                                                                        
						reject(oError);                                                                                                                                                                                                                                          
					}                                                                                                                                                                                                                                                         
				});                                                                                                                                                                                                                                                        
			});                                                                                                                                                                                                                                                         
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
	});                                                                                                                                                                                                                                                           
});                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               