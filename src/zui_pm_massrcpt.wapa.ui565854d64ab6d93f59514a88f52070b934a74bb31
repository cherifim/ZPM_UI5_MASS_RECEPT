sap.ui.define([                                                                                                                                                                                                                                                
    "com/toray/massreceipt/controller/BaseController",                                                                                                                                                                                                         
    "sap/m/MessageBox"                                                                                                                                                                                                                                         
],                                                                                                                                                                                                                                                             
    /**                                                                                                                                                                                                                                                        
     * @param {typeof sap.ui.core.mvc.Controller} Controller                                                                                                                                                                                                   
     */                                                                                                                                                                                                                                                        
    function (BaseController, MessageBox) {                                                                                                                                                                                                                    
        "use strict";                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
        return BaseController.extend("com.toray.massreceipt.controller.ItemsList", {                                                                                                                                                                           
            onInit: function () {                                                                                                                                                                                                                              
                window.This = this; //TODO: to be deleted                                                                                                                                                                                                      
                BaseController.prototype.onInit.call(this);                                                                                                                                                                                                    
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onExecuteGoodReceipt: function (oEvent) {                                                                                                                                                                                                          
                const oSmartTable = this.byId("smartTable")?.getTable();                                                                                                                                                                                       
                if (oSmartTable) {                                                                                                                                                                                                                             
                    if(oSmartTable.getSelectedContexts().length === 0) {                                                                                                                                                                                       
                        MessageBox.error(this.getResourceText("msg.selectIrem.error"));&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                        
                        return;                                                                                                                                                                                                                                
                    }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp+
;&nbsp;                                                                                                                                                                                                                                                        
                    this.getOwnerComponent().setSelectedItemsContexts(oSmartTable.getSelectedContexts());                                                                                                                                                      
                    this.getOwnerComponent().setSelectionChanged(true);                                                                                                                                                                                        
                    this.getRouter().navTo("RouteMovement");                                                                                                                                                                                                   
                }&nbsp;                                                                                                                                                                                                                                        
            },                                                                                                                                                                                                                                                 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
            onBeforeRebindTable: function(oEvent) {                                                                                                                                                                                                            
                const oBindingParams = oEvent.getParameter("bindingParams");                                                                                                                                                                                   
                oBindingParams.parameters = oBindingParams.parameters || {};                                                                                                                                                                                   
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            /**                                                                                                                                                                                                                                                
             * Navigate to Edit PO Item screen (external app)                                                                                                                                                                                                  
             * @param {*} oEvent&nbsp;                                                                                                                                                                                                                         
             * @returns&nbsp;                                                                                                                                                                                                                                  
             */                                                                                                                                                                                                                                                
            onDetailPress: function(oEvent){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                   
                const selectedPoItemCtx = oEvent.getSource()?.getBindingContext();                                                                                                                                                                             
                if(selectedPoItemCtx==null) return;                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                let sPurchaseOrder = selectedPoItemCtx.getProperty("PurchaseOrder");                                                                                                                                                                           
                let sPurchaseOrderItem = selectedPoItemCtx.getProperty("PurchaseOrderItem");                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                //Build navigation hash to the external app (Semantic object = PurchaseOrder, Action = manage)                                                                                                                                                 
                let sHash = "#PurchaseOrder-manage?"                                                                                                                                                                                                           
                          + "/C_PurchaseOrderItemMoniResults.basicSearch="                                                                                                                                                                                     
                          + `&/C_PurchaseOrderTP(PurchaseOrder='${sPurchaseOrder}',DraftUUID=guid'00000000-0000-0000-0000-000000000000',IsActiveEntity=true)`                                                                                                  
                          + `/to_PurchaseOrderItemTP(PurchaseOrder='${sPurchaseOrder}',PurchaseOrderItem='${sPurchaseOrderItem}',DraftUUID=guid'00000000-0000-0000-0000-000000000000',IsActiveEntity=true)`;                                                   
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                               
                //const oCrossAppNavigator = sap.ushell.Container?.getService("CrossApplicationNavigation");&nbsp;                                                                                                                                             
                //oCrossAppNavigator?.toExternal({ target: { shellHash: sHash } });                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                //Open the external app in a new window                                                                                                                                                                                                        
                let url = window.location.href.split('#')[0] + sHash;                                                                                                                                                                                          
                sap.m.URLHelper.redirect(url, true);                                                                                                                                                                                                           
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            /**                                                                                                                                                                                                                                                
             * Open good receiot history popup                                                                                                                                                                                                                 
             * @param {*} oEvent&nbsp;                                                                                                                                                                                                                         
             */                                                                                                                                                                                                                                                
            onOpenHistory: async function(oEvent){                                                                                                                                                                                                             
                this._historyDialog = await this.loadDialogPopup({                                                                                                                                                                                             
                    name: "com.toray.massreceipt.view.fragments.MassReceiptLogs",                                                                                                                                                                              
                    dialog: this._historyDialog                                                                                                                                                                                                                
                });                                                                                                                                                                                                                                            
                this._historyDialog.open();                                                                                                                                                                                                                    
                sap.ui.getCore().byId("historySmartTable")?.getTable()?.getBinding("items")?.refresh(); //Refresh history table content&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                        
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            /**                                                                                                                                                                                                                                                
             * Closes the history dialog.                                                                                                                                                                                                                      
             *                                                                                                                                                                                                                                                 
             * @param {object} oEvent - The event object.                                                                                                                                                                                                      
             */                                                                                                                                                                                                                                                
            onCloseHistory: function(oEvent){                                                                                                                                                                                                                  
                this._historyDialog.close();                                                                                                                                                                                                                   
            }                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
        });                                                                                                                                                                                                                                                    
    });                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               